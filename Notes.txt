replace json lib with faster third-party one
package name convention in main & codestyle: pThirdParty lDomestic?

reorganize this file using section numbers from docs

common function and syncDir for placeholder symlinks
slib/Readme and code comments re commit safety
re-send on missed ack may cause dup with unique msgid at receiver
checksum thread index and service config
  Add storeFile checksum
synchronize access to thread/* form/* adrsbk etc (verify)
storeReceivedThread fConsume() msg with excessive subhead length
storeReceivedAttach prevent dup & invalid filename
Handle*Service limit aResult to op codes with changes
  op code "ma" to insert new message
  op code "mx" to delete message
thread_savetext message for subject & body?
loadThread return set of msgids
ClientState keeps form-table; send "tl" op if changed
  keeps msg panel scroll position
  drop old states
tService.tabs carry names for pinned terms
tThreadState keep tOpenState for each .Terms item
blankform update msg to all clients, include ID
  flag update in msg editor if form is attached
attach size set on save
config file: path for store/, http host & port, ...
test-in: add op open to Gold
test: Orders[n].Note == "print this // hide this"
main: TLS1.3, call api correctly
  secure link to clients
  revise disconnected ClientState files on rename/discard
clean
  slib: add fileThread, fileAttach, fileState ...?
  use file.readat where offset known
  service: "ack" default aResult = []string{"",...}
  tError to fmt.Errorf; separate line
  writestring vs write([]byte(s))
  form: kSuffix* -> kFfnSuffix* 
  thread: mv t*El to read/write section, mv completeThread to top
  test: _prepUpdt closures
gui
  mo: drop draft object after send/discard
  formview: default field values in form-def "defaults" object
    create component with parent param?
    handle multiple form instances
  fix draft edit position reset for long text
  fix update draft editors when shown in other message list tabs
  blankform listsort only when edit pane closed
  attachment links to forms open form editor
  use v-show instead of v-if/else where both elements appear frequently
  use ref/$refs instead of id/getElementById
  hrefs meaningful, or change element to button/span

server try-back-later msg
  gives: reconnect time in tenths of second, reason eg max-idle/shutdown/etc
  reconnect to send
  disconnect when send queue empty

forwarding
  CC menu: forward form + button, unsubscribe button, CC list
    dropped CCs have strikethrough
    on drop CC, send unsubscribe
  sent threads: disable reply buttons if unsubscribed or CC empty
  client notify
    add to notice list
  client delivery
    also handle newthread receipt?
  client confirm
    store mismatched forwarded message alongside thread?
  client unsubscribe
  add non-pinged CCs to adrsbk

notices menu
  log of new pings, invites, threads, msgs, group membership
  fields: from type, alias, threadid, msgid, gid, blurb
  delimit not-seen set, UI give not-seen count
  delimit seen sets ?
  filter (in clientstate) to omit categories
  limit history to 1wk + 2 seen sets (configurable)
  accrete related items in not-seen set
  overwrite not-seen items on new entry
  seen button sends request to update not-seen items
  rewrite file on seen update if nec

alias: add, drop, list; store in sep file
  status pending until ack
ping: save as pending if sent
  lookup-alias-by-pre/suffix
  msg-from: log cc aliases?
    log group msg froms (not preceeded by ping)
groups: 
  storeSent: if group unknown, make file for members in groups/gid?

forms
  list of fields
    label, id, name, type, option names/values, default, layout column ref
    types: checkbox, radio, menu, date, phone, zip code, etc
      labels & checkbox/radio/menu can reference image attachment
    containers: table (fieldnames=col+row), tab/panel
  robot test
  single or multiple column layout
  stylesheet: colors, fonts, borders
  online registries define unique FFNs and required/optional/deprecated fields
    name: domain.name/[path/]form_def
    offer recommended form_blank?
  make *_sent elements attachable
  functions
    blank: per-msg defaults?
      prevent reuse of generated FFN after form dropped?
    on receive, validate result vs registry
    query form-table, form-table item patches (incl omit flag)
    markdown tags form-blank & form-filled, reference attachment
    renderSpec (js) in form-blank preview and form-filled compose
    renderResult (js) in form-blank preview and form-filled preview
    on reply, copy selected form ref to text

one service per window/tab/page
  view panels: [msg editor], msgs (under editor), threads, services
    have service-specified look & ringtone; adjustable by user
  text-boxes over each panel to search: thread, service, all services
    results highlight text in msg panel
    results add tab in thread panel
    search-all jumps to you-service tab?

msg panel
  panel history, per client: panel back/forward buttons change msg list panel
    drop last item if last pair would repeat: abcb + c -> abc
  give thread subject/s
  attachment list pop-up pane
    links jump to relevant msg?
  tags dropdown: add, delete existing
  tabs for msg subsets, per client: user-opened, search result, reply-to chain, all
    pin tab saves state, broadcasts to clients
  list of msgs in archaeological order; scrolling
    remember which msgs are open, per client
    combine consecutive msgs from single user chronologically, tag each with date-time
    ohi status of sender
    reply-to chain link/button per msg
    retain msg header bar at top of panel if topmost visible msg is open
  reply editor opens above msgs
  overlay panel with iframe to view pdf/html/video attachments in browser
  thread-summary popup or tab
    list of excerpts and optional notes, with link to msg of excerpt
    to add item, select text in msg, right-click for add-to-summary, write optional note

thread panel
  archaeological order
  infinite scrolling or back/forward buttons
  permanent tabs: All, Unread, Todo, Form-table
  sort by first/latest ctrl
  tags menu "#" near search box; items open new search tab
  search tabs are client-specific unless saved
    save-search pins tab, notify other clients
  search relevance slider (# positions varies with result set size?)
    lower relevance yields more results
  NewThread button
  mute button to hide panel updates
  you-service
    have origin service's look in msg panel
    permanent thread tabs: todo/tag, contact
    transient thread tabs: search-all results
    thread items include column for svc name
    group consecutive same-service items with color
  form-table view (alternate panel layout)
    presents table of all data received via a certain form
    include ref column with link to thread+msg data source
    drag to order columns, click column to sort rows
    form editor
    form revision history
    export to csv, json, etc

ohi panels
  slide out from services panel
  whos-on normally retracted, can pin display
    indicate disconnect of browser or client
  who-i-ohi

attachment panel
  button per item attaches file to current message
  checkbox on "browse..." form to attach
  search box, adds a tab after Date, Name

services (notifications) panel
  per-item popup shows recent activity in that service
  click item opens tab
  back/forward buttons? switch tab if possible
  panes
    all services, sorted by recent activity
    deadlines, sorted by date
    services with user-defined tags
  new msg button?
    enter contact name (aided by menu)
    jumps to relevant service
    thread list panel shows recent threads including the contact/s
  find/join service widget
    display service certificate
    user can specify network (e.g. NIC)
    select other nodes to add on service

msg viewer
  see/hide-chain button opens/closes reply-to chain
  way to link attachment in upload dir for future use
  button to copy form to our collection
  enable revision of last-sent msg
    single item on msg panel if no intervening msgs (ie combine consecutive)
    list rev history on revised msgs
  lookup/rewrite bit.ly etc links

msg editor
  import alias list into Cc
  search & replace
  use markdown format
    formatting characters shown in color & boldface
    change linebreak to ^ or non-ascii character
    change em & strong to ~
    insert > when dividing >'d paragraph
    img/etc hrefs must be to attachment
    help pane shows formatting characters; click or ctrl-? to pop-up docs
    can render tables as charts, or chart input as table?
    select from menu of common & service-supplied stylesheets
  preview rendering
    short pane below or above editor showing current lines, collapsible
      toggle with ctrl-something
    pane expands to scrolling pop-up on ctrl-J/F?, repeat/enter/esc to close
      if pane at start/end of message
         expand down/up, grow pop-up on scroll to x% of vh
      highlight current cursor position
      scroll with IJKLUO/ESDFWR, page-up/down with [shift-]space
  upload attachment
    drag/drop or copy/paste file, file dialog box
    menu of upload dir; sort by date/filename
    attachment hrefs
  attach by reference to previous attachment
  attach icalendar object
  attach pasted HTML
    display in iframe
  to/attach-list expand to multiple columns if nec
  on msg add-CC enable forwarding
    forwarding buttons: next msg, reply-to chain, all msgs
    send index entry for initial message (if not forwarded)
  add msg to thread by ref-to msg link
    placeholder for recipients who did not receive original
  branch-reply/forward
    make new thread with copy of (or ref-to for recipients of original) replied msg
    buttons copy-next, copy-all
    ref parent thread & msg
  reply with tag (continues at link, closed, defer until date, priority, user-defined)
  forms menu & editor
    can fill in form or leave blank
  slides/pages
    slide hrefs
  thread/message hyperlinks
    may indicate excerpts (list of byte ranges)
  charts menu; outputs templates
  form-table queries?
  message templates menu
  cursor nav mode ctrl-H?
    different highlight & cursor color
    restore prior selection if cursor hasn't moved
    repeat/esc exit mode
    IJKLUO/ESDFWR [shift-]space set cursor position
    ctrl-anyOfAbove select text
    formatting characters work as toggles on selection
    enter preserve selection, exit mode
    cut/copy/paste/delete work on selection, exit mode

error log
  show last error, expand to show scrolling list
  item on settings menu

meta-messages
  reader opinion value (-5 to +5 or none)
    summaries in index
    display as bar graph, y-axis gives totals

UI controls that change data state get hand cursor, others get arrow
certain buttons show confirmation pop-up next to click point
  send, discard new msg, close search tab

msg link: MessageGo() combining ThreadGo(thread_id) + TabAdd(msg:msg_id)

address book
  alias lists for import into Cc?
  reply button on pings & invites
  join/leave button on invites
  query s,n returns n matches starting with s
    s$ ending in s

clientstate
  history status, thread tabs, selected tab
  selected thread, service tabs, selected tab

require app password for certain ops after idle period

groups
  popup with aliases on msg panel (enable when group in recipients)
    drop & contact & write-to links
  popup with groups on thread panel
    edit & select links, select opens tab
  group-invite option on compose/reply UI
  SubHead.Attn []string: aliases of members to be flagged; instead of .Cc

aliases
  popup with aliases on compose/reply UI
    drop & revive links, add-new link

nodes
  popup with ref names on you-service

make browser cache data URIs for fast service reload
  getSvcs, getTodos, getThreads, getThreadTabs, getMsgs, getPicture, getMsgHistory
  on websocket update msg, silently reload relevant URL?

distribute tool state to other nodes
  services, saved searches, tags, contacts

msg signing and signature validation

define in-msg header
  dates: authored, received, read (client)
  subject
  recipients
  ack-requested/acknowledged
  action requested by [recipients]

choose number of months to store unreplied incoming threads from each group (or service?)

streaming de/compression on get/post attachment, except for compressed formats

on attachment re-send, upload diff (placeholder if no difference)
track revisions for attachment
store 1 of any attachment received/sent multiple times

new-thread draft list

tag/todo lists
  select msg, add tags & optional deadline-date & comment
  tag view sorted in deadline chronological order, no-deadline items last

calendar
  endless scrolling list of weeks
    zoomable to full screen
  sunday after saturday, adjustable week-start day
  day (row) height adjustable by zoom (shift mouse wheel)
  give number of hours free on each day & week
  record attached icalendar objects
  attach icalendar objects to msgs
  send new objects to calendar service
  pull objects from calendar service

contacts
  (list of form-tables? contact tag instead of separate database?)
  distribution & receipt of contact info doc
  std metadata, cached signature
  pinged alias

support plugins for non-messaging threads

elembe features
  tab for collections/projects
  collection has
    layout file: any number of screen/document layouts
    data files, ref'd in layouts
    revision history
    associated mnm group
  alternate msg panel design
  layout manager, history view
  plugins for data object view/edit

storage
  service directory, subdirectory per service
    styling directory: css & image files
    icalendar directory: year & json index per file
    attachment directory: link file if checksum matches
    thread directory
      push old threads into zip
    msg index with thread id, msg offset count, msg metadata
      keep backup db copy
      rebuild database from files to recover from db corruption & backup failure
  upload directory
    flag unsent items with name_
    drop items sent and untouched for >N days
    can pin items in place?
  index directory
    attachment index: checksum, filename
    msg index here?
    tag index
    full-text index
  nodes file
