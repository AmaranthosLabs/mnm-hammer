replace json lib with faster third-party one
package name convention in main & codestyle: pThirdParty lDomestic?

reorganize this file using section numbers from docs

common function and syncDir for placeholder symlinks
slib/Readme and code comments re commit safety
checksum thread index and service config
  Add storeFile checksum
synchronize access to thread/* form/* adrsbk etc (verify)
storeReceivedThread fConsume() msg with excessive subhead length
storeReceivedAttach prevent dup & invalid filename
storeFwdNotify reject request if sender not in Cc list
Handle*Service limit aResult to op codes with changes
  op _m,a,- to delete message if client mo has it
thread_savetext message for subject & body?
state: keeps msg panel scroll position?
  drop old states
thread: on forward, do notified nodes confirm to sender?
  verify forwarding when thread missing recently-sent messages from other senders
all: use string(bytes.ToValidUTF8(buf, nil)) for unknown buf contents
slib: %-encode initial '.' in filename
  makeLocalId() could yield identical string on different nodes
form: Add() reject filename ".*"
  blankform update msg to all clients, include ID
  flag update in msg editor if form is attached
    verify that form-save creates new file
  form-fill option to log data in ..._recv FFT
attach size set on save
util: app or script to find hard-linked files, run robocopy, replace found files with hard-links
search: sort threads with a draft to top for T+n hours
  +n in OrigAuthor for outbound msgs?
  mouseover LastAuthor to see all authors
config file: path for store/, http host & port, ...
test-in: add op open to Gold
  replace Op:test with Poll on prior Order
  poll on send ops
test:
  setupTestDir() use http conn
  try repeated complete functions via defer sCrashFn()
  create test blob in test-run, checksum, symlink in upload, attach, verify checksum on receipt
  Orders[n].Note == "print this // hide this"
  watch for unexpected changes: get all "xy" ops after each Order, compare with expected state
main: TLS1.3, call api correctly https://github.com/golang/go/issues/31224
  stream audio/video to client
  secure link to clients
  revise disconnected ClientState files on rename/discard
  tTmtpInput log error; retry .Temporary(); drop logging in HandleTmtpService & its calls
    _readLink check tTmtpInput for error
ohi: on receipt, add to adrsbk if missing
  what is impact of nodes on server ohi list
service: allow *.tmp service names
  allow svcid change
  "registered" needs transaction with adrsbk & config
  add-account: check whether net address works
  add getUidService()
mswin: can't fsync directory, so verify that dirctory updates are durable after syscall returns
  if not, can recover lost files via FILE_OPEN_BY_FILE_ID?
clean
  os.RemoveAll doesn't return os.IsNotExist(err)
  slib: add fileThread, fileForm->fileFft?, fileBlank ...
  use file.readat where offset known
  service: "ack" default aResult = []string{"",...}
  tError to fmt.Errorf; separate line
  fprintf or writestring vs write([]byte(s))
  form: kSuffix* -> kFfnSuffix* 
  thread: mv t*El to read/write section, mv completeThread to top
    tComplete methods to encapsulate msgid logic
  test: _prepUpdt closures
  main: logError() prints err msg
gui
  sleeping Catalina MacOS drops browser websocket
  change ml/tl panel width via centerline drag
  template: test <%.isLocal%> with template, so browser doesn't need to
  tour: better graphics
  date: delimiter character per locale
    am/pm option
  ao: rename ano
  mo: drop draft object after send/discard
  formview: default field values in form-def "defaults" object
    create component with parent param?
    allow multiple results from a form via [?n](...), where n=0 is unlimited
    attach-fill to paperclip button that changes to checkmark
  markdown: attachment hyperlinks display mnm-viewer or download icon
    disable h2/h1 heading style by -/= on next line
    prevent excess rendering
  draft:
    preview panel link to locate associated draft, scrolling msg-list to right place
    recipients hyperlink next to [self] when no recipients
    to-summary abbrev names
    bug causes occasional reopen after update & close
    attachmt menu has links to clip markdown
    drag/drop attachment (also in files menu)
    progress bar on long outgoing msgs
    indicate when msg sent
    button to insert quoted markdown
    _m updates ml & tl fields; omit ml & tl in results
  blankform listsort only when edit pane closed
    validate on send
  docs: pin menu open?, resize pane
  cc: bold last alias added
    no recipients indicates [self]?
    note-field tooltip; swap position with to-field?
    tab-key from to-field sets focus in draft textarea
  attachments:
  FFT: indicate empty records when $empty:true
  svcadd: indicate success/failure
  notice: audio tone option
    count in window title
    show errors on local site
  adrsbk: change ohi-to selection via enter-key?
  msg-list: outside OPEN tab, open msg shouldn't mark it seen?
    or open unread msg in any tab sets it open in OPEN tab
    keep scroll offsets for certain tabs
    goLink scrolls to referenced msg; result include "_l",msgid
  thread-list: keep scroll offsets for certain tabs?
  clean:
    css use .outer .inner {...} when .inner not standalone
    after text use <!----> to eliminate whitespace before </tag>
    use v-show instead of v-if/else where both elements appear frequently
    use ref/$refs instead of id/getElementById
    hrefs meaningful, or change element to button/span

server try-back-later msg
  gives: reconnect time in tenths of second, reason eg max-idle/shutdown/etc
  reconnect to send
  disconnect when send queue empty

minimize browser update traffic
  websocket.js keep list of request types, with isVisible & isCurrent state
  on user action, gui.vue update visible types, via mnm.Xyz()
    call xhr when type becomes visible, if !isCurrent, set isCurrent=true
  on updt msg, websocket skip xhr, if !isVisible, set isCurrent=false

nodes
  local service list all known nodes, sublist of accounts per-node
    button to disable node's accounts
  node list
    ui show online status (from ohi msg)
    ui to change name for non-pending
    on pin fail, prompt for new pin&addr
    "user" broadcast item not "active" on arrival; 2nd broadcast for "active"
      on first login, check status; disconnect if already confirmed/active
    status:ready must complete on matching nodeid, or be deactivated?
  synchronize: thread draft, ping draft
    for tag sync, send names of svc tags, don't reuse those names on receiver
    p2p xfer to local nodes
    log original thread draft
      tService index of logged drafts, map[string]bool
      sendThread & sendPing append drop-draft to log
      sendSync lock thread drafts, send diff of original vs current data
        clear log, unlock drafts
    recv msg & ping clear draft at nodes
  files & forms replication
    svc: list items previously attached in threads
  on receiver
    indicate xfers in settings menu
    timeout listen mode
    separate http.server instance? 
    MakeNode(bodyReader)
      syscall.o_direct; syscall.open patch
      handle duplicate upload items or omit
  on sender
    drop thread drafts, update indexes
    checksum archive
    HandleUpdtService reject calls during op

tags
  blurb to describe tag?
  rebuild file on search-index build?
  in search result, textbox to rename tag
    button to remove tag
  on open msgs
    select-tag adds search tab?

forwarding
  verify correct when forwarded thread lacks in-transit msgs from other senders
  CC menu: forward form + button, unsubscribe button, CC list
    dropped CCs have strikethrough
    on drop CC, send unsubscribe
  sent threads: disable reply buttons if unsubscribed or CC empty
  client notify
    add to notice list
  client delivery
    also handle newthread receipt?
  client confirm
    store mismatched forwarded message alongside thread?
  client unsubscribe
  add non-pinged CCs to adrsbk

notices menu
  log threads, msgs, group membership
  delimit seen sets ?
  categories filter in clientstate?
  configurable history limit, default 1wk + 2 seen sets
  accrete related items in not-seen set
  overwrite not-seen items on new entry

alias: add, drop, list; store in sep file
  status pending until ack
ping: save as pending if sent
  lookup-alias-by-pre/suffix
  msg-from: log cc aliases?
    log group msg froms (not preceeded by ping)
groups: 
  storeSent: if group unknown, make file for members in groups/gid?

forms
  list of fields
    label, id, name, type, option names/values, default, layout column ref
    types: checkbox, radio, menu, date, phone, zip code, etc
      labels & checkbox/radio/menu can reference image attachment
    containers: table (fieldnames=col+row), tab/panel
  robot test
  single or multiple column layout
  stylesheet: colors, fonts, borders
  online registries define unique FFNs and required/optional/deprecated fields
    name: domain.name/[path/]form_def
    offer recommended form_blank?
  make *_sent elements attachable
  functions
    blank: per-msg defaults?
      prevent reuse of generated FFN after form dropped?
    on receive, validate result vs registry
    query form-table, form-table item patches (incl omit flag)
    markdown tags form-blank & form-filled, reference attachment
    renderSpec (js) in form-blank preview and form-filled compose
    renderResult (js) in form-blank preview and form-filled preview
    on reply, copy selected form ref to text

enable service-specified skin & ringtone; adjustable by user

msg panel
  tabs, per client: reply-to chain
    pin tab? saves state, broadcasts to clients & nodes
    search tabs highlight result text
  combine consecutive msgs from single user chronologically, tag each with date-time
  ohi status of sender?
  reply-to chain link/button per msg
  retain msg header bar at top of panel if topmost visible msg is open
  overlay panel to view pdf/html/video attachments?
  thread-summary popup or tab
    list of excerpts and optional notes, with link to msg of excerpt
    to add item, select text in msg, right-click for add-to-summary, write optional note

thread panel
  infinite scrolling or back/forward buttons
  sort by first/latest toggle
  named pinned tabs, notify other clients & nodes
  search relevance slider (# positions varies with result set size?)
    lower relevance yields more results
  mute button to hide panel updates
  local service
    have origin service's look in msg panel
    permanent thread tabs: todo/tag, contact
    transient thread tabs: search-all results
    thread items include column for svc name
    group consecutive same-service items with color
  form-table view
    drag to order columns, click column to sort rows
    per-row link to form-viewer (in attachments?)
    export to csv, json, etc
  events table, via EVENTS tab

ohi panel
  normally hidden, can pin panel

files menu
  search box, adds a tab after Date, Name
  copy msg body to text file

services (notifications) panel
  search box searches svc name, description, etc
    prefix all: or second box jumps to local tab?
  back/forward buttons? switch tab if possible
  panes
    all services, sorted by recent activity
    deadlines, sorted by date
    services with user-defined tags
  contact search?
    enter contact name (aided by menu)
    jumps to relevant service
    thread list panel shows recent threads including the contact/s
  find/join service widget
    display service certificate
    user can specify network (e.g. NIC)
    select other nodes to add on service
  form to disconnect or delete service

msg viewer
  reply-chain button opens reply-to tab
  way to link attachment in upload dir for future use
  button to copy form to our collection
  attachment viewer: list files in archive, zip, tar, etc
    display contents of archive item; show path of item in panel
  enable revision of last-sent msg
    single item on msg panel if no intervening msgs (ie combine consecutive)
    list rev history on revised msgs
    limit size of total revs to N% or N characters
  on click, lookup & notify redirected links; bit.ly etc

msg editor
  send-with-delay option to allow editing
    edit stops timer
    stopwatch animation to show time left?
  import alias list into Cc
  search & replace
  use markdown format
    formatting characters shown in color & boldface
    change linebreak to ^ or non-ascii character
    change em & strong to ~
    insert > when dividing >'d paragraph
    video/audio object via ![>](ref)
    can render tables as charts, or chart input as table?
    select from menu of common & service-supplied stylesheets
  lookup & suggest rewrite of redirecting links
  preview pop-up on ctrl-J/F?, repeat/esc to close
    highlight line for current cursor position
    scroll with cursor position changes
  upload attachment via drag/drop, copy/paste file or data
  attach by reference to previous attachment
  create & attach icalendar object, markdown ![@](ref)
  attach-list expand to multiple columns if nec
  add msg to thread by ref-to msg link
    placeholder for recipients who did not receive original
  branch-reply
    make new thread with copy/excerpt of (or ref-to for recipients of original) replied msg
    button copy-next adds msg from reply-chain
    ref parent thread & msg
  reply with meta-msg (continues at link, closed, defer until date, priority, user-defined)
  slides/pages; markdown hrefs
    set background & foreground colors of slides
  embedded tags via '\tag/tags/tagged #name...'; drop prior tag with !name
  thread/message hyperlinks may indicate excerpts (list of byte ranges)
  charts menu; outputs templates
  poll/vote component
  form-table queries?
  message templates menu

error log: section for unseen errors

meta-messages
  sender-specified opts
  request response
  intent to ack/respond
  reader ack/opinion (-5 to +5 or none)
    msg SubHead.RequestAck enables ack UI
      auto-tag msg with Todo?
    summaries in index
    display as bar graph, y-axis gives totals
  poll/vote response

UI controls that change data state get hand cursor, others get arrow
  certain buttons show confirmation pop-up next to click point
    send, discard new msg, close search tab

address book
  alias lists for import into Cc?
  reply button on pings & invites
  join/leave button on invites
  query s,n returns n matches starting with s
    s$ ending in s

require app password for certain ops after idle period

groups
  popup with aliases on msg panel (enable when group in recipients)
    drop & contact & write-to links
  popup with groups on thread panel
    edit & select links, select opens tab
  group-invite option on compose/reply UI
  SubHead.Attn []string: aliases of members to be flagged
  choose number of months to store unreplied incoming threads from group (or service?)

make browser cache data URIs for fast service reload

msg signing and signature validation

define in-msg header
  dates: authored, received, read (client)
  action requested by [recipients]

streaming de/compression on get/post attachment, except for compressed formats

on attachment re-send, upload diff (placeholder if no difference)
  track revisions for attachment

store 1 of any attachment received/sent multiple times

new-thread draft list

provide tags which reference: message, icalendar event

calendar
  endless scrolling list of weeks
    zoomable to full screen
  sunday after saturday, adjustable week-start day
  day (row) height adjustable by zoom (shift mouse wheel)
  give number of hours free on each day & week
  record attached icalendar objects
  attach icalendar objects to msgs
  send new objects to calendar service
  pull objects from calendar service

contacts
  (list of form-tables? contact tag instead of separate database?)
  distribution & receipt of contact info doc
  std metadata, cached signature
  pinged alias

support plugins for non-messaging threads

elembe features
  tab for collections/projects
  collection has
    layout file: any number of screen/document layouts
    data files, ref'd in layouts
    revision history
    associated mnm group
  alternate msg panel design
  layout manager, history view
  plugins for data object view/edit

storage
  service directory, subdirectory per service
    styling directory: css & image files
    icalendar directory: year & json index per file
    attachment directory: link file if checksum matches
    thread directory
      push old threads into zip
  upload directory
    flag unsent items with name_
    drop items sent and untouched for >N days
    can pin items in place?
  index directory
    attachment index: checksum, filename
  rebuild index from files to recover from db corruption
